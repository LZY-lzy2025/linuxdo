name: Linux Do Auto Login

on:
  workflow_dispatch: # 允许手动触发
  schedule:
    - cron: '0 1 * * *' # 每天 UTC 1:00 运行 (北京时间 9:00)

jobs:
  login:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    - name: Install Dependencies
      run: |
        pip install DrissionPage

    - name: Setup Xray Proxy (VLESS)
      run: |
        # 1. 下载 Xray (修复了这里的链接格式错误)
        wget https://github.com/XTLS/Xray-core/releases/download/v1.8.6/Xray-linux-64.zip
        unzip Xray-linux-64.zip
        chmod +x xray
        
        # 2. 写入配置 (从 Secret 获取)
        echo "${{ secrets.VLESS_JSON }}" > config.json
        
        # 3. 后台运行 Xray
        ./xray -c config.json &
        
        # 4. 等待代理启动
        sleep 3
        echo "Xray proxy started."

    - name: Run Login Script
      env:
        LINUXDO_USER: ${{ secrets.LINUXDO_USER }}
        LINUXDO_PASS: ${{ secrets.LINUXDO_PASS }}
      run: |
        # 确保系统有中文字体，防止截图乱码 (可选)
        sudo apt-get install -y fonts-wqy-zenhei
        python login_script.py

    - name: Upload Screenshots
      if: always() # 无论成功失败都上传截图
      uses: actions/upload-artifact@v4
      with:
        name: debug-screenshots
        path: "*.png"
